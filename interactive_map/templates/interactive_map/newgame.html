{% extends "main/base.html" %}
{% block content %}
	<div id='map' style="position:fixed; top:56px; left:0; width:80%; height:93%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999;"></div>
	<script>
	mapboxgl.accessToken = "{{ user.profile.mapbox_key }}";
	var map = new mapboxgl.Map({
	container: 'map',
	style: 'mapbox://styles/egrelayson/ck6g7arh20ixk1inz309nbnh8',
	center: [121.098434, 14.648697], // starting position
	zoom: 19, // starting zoom
	pitch: 40,
	bearing: 20,
	antialias: true
	});

	// Add zoom and rotation controls to the map.
	map.addControl(new mapboxgl.NavigationControl());

	map.on('click', function(e) {
	  var features = map.queryRenderedFeatures(e.point, {
	    layers: ['reg-process'] // replace this with the name of the layer
	  });

	  if (!features.length) {
	    return;
	  }

	  var feature = features[0];

	  var popup = new mapboxgl.Popup({ offset: [0, -15] })
		    .setLngLat(feature.geometry.coordinates)
		    .setHTML('<p>' + feature.properties.proc + '</p>')
		    .addTo(map);
	});

	// // The 'building' layer in the mapbox-streets vector source contains building-height
	// // data from OpenStreetMap.
	map.on('load', function() {
	// // Insert the layer beneath any symbol layer.
		var layers = map.getStyle().layers;
		 
		var labelLayerId;
		for (var i = 0; i < layers.length; i++) {
			if (layers[i].type === 'symbol' && layers[i].layout['text-field']) {
				labelLayerId = layers[i].id;
				break;
			}
		}

		map.addLayer({
			'id': '3d-buildings',
			'source': 'composite',
			'source-layer': 'building',
			'filter': ['==', 'extrude', 'true'],
			'type': 'fill-extrusion',
			'minzoom': 15,
			'paint': {
				'fill-extrusion-color': '#aaa',
				 
				// use an 'interpolate' expression to add a smooth transition effect to the
				// buildings as the user zooms in
				'fill-extrusion-height': [
				"interpolate", ["linear"], ["zoom"],
				15, 0,
				15.05, ["get", "height"]
				],
				'fill-extrusion-base': [
				"interpolate", ["linear"], ["zoom"],
				15, 0,
				15.05, ["get", "min_height"]
				],
				'fill-extrusion-opacity': .6
			}
		}, labelLayerId);
	});

	</script>
	<div><small class="text-muted">
		<a class="ml-2" href="{% url 'imap-menu' %}">Back to the Interactive Map Menu</a>
	</small></div>
{% endblock content %}